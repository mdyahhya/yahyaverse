<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Barcode System</title>
    
    <!-- Required Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            color: #000000;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 14px;
        }

        .section {
            background: #ffffff;
            border: 2px solid #000000;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #000000;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .btn {
            background: #000000;
            color: #ffffff;
            border: none;
            padding: 14px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn:hover {
            background: #333333;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        .barcode-preview {
            margin-top: 30px;
            padding: 30px;
            background: #fafafa;
            border: 2px dashed #cccccc;
            border-radius: 8px;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .barcode-preview.has-barcode {
            background: #ffffff;
            border: 2px solid #000000;
        }

        #barcodeCanvas {
            max-width: 100%;
            margin-bottom: 15px;
        }

        .barcode-info {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 6px;
            font-size: 13px;
            width: 100%;
        }

        .barcode-info-row {
            margin: 5px 0;
        }

        .barcode-info-label {
            font-weight: 600;
            display: inline-block;
            width: 80px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .scanner-container {
            margin-top: 20px;
        }

        #reader {
            border: 2px solid #000000;
            border-radius: 8px;
            overflow: hidden;
            max-width: 100%;
        }

        .hidden {
            display: none;
        }

        .empty-state {
            color: #999;
            font-size: 14px;
        }

        input[type="file"] {
            display: none;
        }

        /* Product Info Card */
        .product-card {
            background: #ffffff;
            border: 3px solid #000000;
            border-radius: 12px;
            padding: 0;
            margin-top: 30px;
            overflow: hidden;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-header {
            background: #000000;
            color: #ffffff;
            padding: 20px;
            text-align: center;
        }

        .product-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .product-status {
            display: inline-block;
            padding: 6px 16px;
            background: #ffffff;
            color: #000000;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        .product-status.in-stock {
            background: #4CAF50;
            color: #ffffff;
        }

        .product-status.out-of-stock {
            background: #f44336;
            color: #ffffff;
        }

        .product-body {
            padding: 30px;
        }

        .product-image {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        .product-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .product-detail {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .product-detail-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }

        .product-detail-value {
            font-size: 18px;
            font-weight: 600;
            color: #000000;
        }

        .product-price {
            font-size: 32px;
            font-weight: 700;
            color: #000000;
        }

        .product-description {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #000000;
        }

        .product-description-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-description-text {
            color: #333;
            line-height: 1.6;
        }

        .message-section {
            background: #fffacd;
            border: 2px solid #000000;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .message-section-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-section-text {
            color: #000;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .barcode-display {
            text-align: center;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            margin-top: 20px;
        }

        .barcode-display canvas {
            max-width: 100%;
        }

        .no-product {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .no-product svg {
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .scan-instruction {
            text-align: center;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 2px dashed #ddd;
            margin-top: 20px;
        }

        .scan-instruction svg {
            margin-bottom: 15px;
        }

        .scan-instruction p {
            color: #666;
            margin-bottom: 20px;
        }

        .char-count {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .section {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .product-detail-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>Complete Barcode System</h1>
    <p class="subtitle">Generate barcodes with messages & Scan to view full product info</p>

    <!-- Generator Section -->
    <div class="section">
        <div class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="16" rx="2"/>
                <line x1="7" y1="8" x2="7" y2="16"/>
                <line x1="11" y1="8" x2="11" y2="16"/>
                <line x1="15" y1="8" x2="15" y2="16"/>
                <line x1="17" y1="8" x2="17" y2="16"/>
            </svg>
            Generate Barcode
        </div>

        <div class="form-group">
            <label for="itemName">Item Name</label>
            <input type="text" id="itemName" placeholder="e.g., Wireless Mouse">
        </div>

        <div class="form-group">
            <label for="itemNumber">Item Number (Barcode ID)</label>
            <input type="text" id="itemNumber" placeholder="e.g., 1234567890123" maxlength="13">
        </div>

        <div class="form-group">
            <label for="itemPrice">Price ($)</label>
            <input type="number" id="itemPrice" placeholder="e.g., 29.99" step="0.01" min="0">
        </div>

        <div class="form-group">
            <label for="itemMessage">Custom Message (Optional)</label>
            <textarea id="itemMessage" placeholder="Add a custom message that will be saved with this barcode..." maxlength="500"></textarea>
            <div class="char-count"><span id="messageCount">0</span>/500 characters</div>
        </div>

        <div class="button-group">
            <button class="btn" onclick="generateBarcode()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="16 16 12 12 8 16"/>
                    <line x1="12" y1="12" x2="12" y2="21"/>
                    <path d="M20.39 18.39A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.3"/>
                </svg>
                Generate Barcode
            </button>

            <button class="btn btn-secondary" onclick="saveToDatabase()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                Save to Database
            </button>
        </div>

        <div id="barcodePreview" class="barcode-preview">
            <p class="empty-state">Your barcode will appear here</p>
        </div>
    </div>

    <!-- Scanner Section -->
    <div class="section">
        <div class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
            </svg>
            Scan Barcode
        </div>

        <div class="button-group">
            <button class="btn" onclick="startCamera()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                    <circle cx="12" cy="13" r="4"/>
                </svg>
                Open Camera
            </button>

            <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                Upload Image
            </button>

            <button class="btn btn-secondary hidden" id="stopBtn" onclick="stopCamera()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="6" y="6" width="12" height="12"/>
                </svg>
                Stop Camera
            </button>
        </div>

        <input type="file" id="fileInput" accept="image/*" onchange="scanFromFile(event)">

        <div class="scanner-container">
            <div id="reader" class="hidden"></div>
        </div>

        <div id="scanInstruction" class="scan-instruction">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <rect x="3" y="4" width="18" height="16" rx="2"/>
                <line x1="7" y1="8" x2="7" y2="16"/>
                <line x1="11" y1="8" x2="11" y2="16"/>
                <line x1="15" y1="8" x2="15" y2="16"/>
                <line x1="17" y1="8" x2="17" y2="16"/>
            </svg>
            <p>Click "Open Camera" or "Upload Image" to scan a barcode</p>
        </div>
    </div>

    <!-- Product Display Section -->
    <div id="productDisplay" class="hidden"></div>

    <script>
        let html5QrCode = null;
        let currentBarcodeData = null;

        // Character counter
        document.getElementById('itemMessage').addEventListener('input', function(e) {
            document.getElementById('messageCount').textContent = e.target.value.length;
        });

        // Enhanced product database with messages
        const productDatabase = {
            '1234567890123': {
                name: 'Wireless Mouse',
                barcode: '1234567890123',
                price: 29.99,
                category: 'Electronics',
                brand: 'TechPro',
                stock: 'In Stock',
                sku: 'WM-2024-001',
                description: 'Ergonomic wireless mouse with precision tracking and 18-month battery life. Features include silent clicking, adjustable DPI settings, and universal compatibility with Windows, Mac, and Linux systems.',
                manufacturer: 'TechPro Industries',
                warranty: '2 Years',
                weight: '85g',
                message: 'Welcome! This is our best-selling wireless mouse. Perfect for office work and gaming. Don\'t forget to check out our extended warranty options!'
            },
            '9876543210987': {
                name: 'USB-C Cable 6ft',
                barcode: '9876543210987',
                price: 15.99,
                category: 'Accessories',
                brand: 'ConnectPlus',
                stock: 'In Stock',
                sku: 'UC-6FT-BLK',
                description: 'Premium braided USB-C cable supports fast charging up to 100W and data transfer speeds up to 480Mbps. Durable design with reinforced connectors for extended lifespan.',
                manufacturer: 'ConnectPlus Corp',
                warranty: '1 Year',
                weight: '42g',
                message: 'High-quality cable tested for 10,000+ bends. Compatible with all USB-C devices!'
            },
            '5551234567890': {
                name: 'Bluetooth Headphones',
                barcode: '5551234567890',
                price: 89.99,
                category: 'Audio',
                brand: 'SoundWave',
                stock: 'In Stock',
                sku: 'BH-PRO-300',
                description: 'Premium over-ear Bluetooth headphones with active noise cancellation, 30-hour battery life, and Hi-Fi audio quality. Includes carrying case and airplane adapter.',
                manufacturer: 'SoundWave Audio',
                warranty: '2 Years',
                weight: '250g',
                message: 'Award-winning sound quality! These headphones have received 5-star reviews from tech enthusiasts worldwide. Try our 30-day satisfaction guarantee!'
            },
            '7778889990001': {
                name: 'Portable SSD 1TB',
                barcode: '7778889990001',
                price: 149.99,
                category: 'Storage',
                brand: 'DataVault',
                stock: 'Out of Stock',
                sku: 'SSD-1TB-EXT',
                description: 'Ultra-fast portable SSD with read speeds up to 1050MB/s. Shock-resistant design with USB 3.2 Gen 2 interface. Perfect for photographers and video editors.',
                manufacturer: 'DataVault Technologies',
                warranty: '5 Years',
                weight: '68g',
                message: 'Currently out of stock. Expected back in stock on March 15th. Reserve yours now with a 10% pre-order discount!'
            }
        };

        function generateBarcode() {
            const itemName = document.getElementById('itemName').value.trim();
            const itemNumber = document.getElementById('itemNumber').value.trim();
            const itemPrice = document.getElementById('itemPrice').value.trim();
            const itemMessage = document.getElementById('itemMessage').value.trim();

            if (!itemName || !itemNumber || !itemPrice) {
                alert('Please fill in Item Name, Item Number, and Price');
                return;
            }

            if (!/^\d+$/.test(itemNumber)) {
                alert('Item number should contain only digits');
                return;
            }

            currentBarcodeData = {
                name: itemName,
                number: itemNumber,
                price: itemPrice,
                message: itemMessage
            };

            const preview = document.getElementById('barcodePreview');
            preview.classList.add('has-barcode');
            preview.innerHTML = '';

            const canvas = document.createElement('canvas');
            canvas.id = 'barcodeCanvas';
            preview.appendChild(canvas);

            try {
                JsBarcode(canvas, itemNumber, {
                    format: "CODE128",
                    width: 2,
                    height: 100,
                    displayValue: true,
                    fontSize: 14,
                    margin: 10
                });

                const infoDiv = document.createElement('div');
                infoDiv.className = 'barcode-info';
                infoDiv.innerHTML = `
                    <div class="barcode-info-row">
                        <span class="barcode-info-label">Item:</span>
                        <span>${itemName}</span>
                    </div>
                    <div class="barcode-info-row">
                        <span class="barcode-info-label">Number:</span>
                        <span>${itemNumber}</span>
                    </div>
                    <div class="barcode-info-row">
                        <span class="barcode-info-label">Price:</span>
                        <span>$${parseFloat(itemPrice).toFixed(2)}</span>
                    </div>
                    ${itemMessage ? `
                    <div class="barcode-info-row" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                        <span class="barcode-info-label">Message:</span>
                        <span style="display: block; margin-top: 5px;">${escapeHtml(itemMessage)}</span>
                    </div>
                    ` : ''}
                `;
                preview.appendChild(infoDiv);

                const downloadBtn = document.createElement('button');
                downloadBtn.className = 'btn';
                downloadBtn.style.marginTop = '20px';
                downloadBtn.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Download Barcode
                `;
                downloadBtn.onclick = downloadBarcode;
                preview.appendChild(downloadBtn);

            } catch (error) {
                alert('Error generating barcode: ' + error.message);
            }
        }

        function saveToDatabase() {
            if (!currentBarcodeData) {
                alert('Please generate a barcode first');
                return;
            }

            // Add to local database
            productDatabase[currentBarcodeData.number] = {
                name: currentBarcodeData.name,
                barcode: currentBarcodeData.number,
                price: parseFloat(currentBarcodeData.price),
                category: 'Custom',
                brand: 'User Added',
                stock: 'In Stock',
                sku: 'CUSTOM-' + currentBarcodeData.number,
                description: 'User-generated product entry',
                manufacturer: 'N/A',
                warranty: 'N/A',
                weight: 'N/A',
                message: currentBarcodeData.message || 'No custom message added.'
            };

            alert('Product saved to database! You can now scan this barcode to see full details.');
        }

        function downloadBarcode() {
            const canvas = document.getElementById('barcodeCanvas');
            if (!canvas) return;

            const exportCanvas = document.createElement('canvas');
            const ctx = exportCanvas.getContext('2d');
            
            const messageLines = currentBarcodeData.message ? wrapText(ctx, currentBarcodeData.message, 700) : [];
            const lineHeight = 20;
            const messageHeight = messageLines.length > 0 ? messageLines.length * lineHeight + 80 : 0;
            
            exportCanvas.width = Math.max(canvas.width, 750);
            exportCanvas.height = canvas.height + messageHeight + 150;
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);
            
            const barcodeX = (exportCanvas.width - canvas.width) / 2;
            ctx.drawImage(canvas, barcodeX, 20);
            
            ctx.fillStyle = '#000000';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            
            const centerX = exportCanvas.width / 2;
            let textY = canvas.height + 40;
            
            ctx.fillText(`Item: ${currentBarcodeData.name}`, centerX, textY);
            textY += 25;
            ctx.fillText(`Number: ${currentBarcodeData.number}`, centerX, textY);
            textY += 25;
            ctx.fillText(`Price: $${parseFloat(currentBarcodeData.price).toFixed(2)}`, centerX, textY);
            
            if (messageLines.length > 0) {
                textY += 40;
                ctx.font = 'bold 12px Arial';
                ctx.fillStyle = '#666666';
                ctx.textAlign = 'left';
                ctx.fillText('MESSAGE:', 25, textY);
                
                textY += 25;
                ctx.fillStyle = '#000000';
                ctx.font = '14px Arial';
                
                messageLines.forEach(line => {
                    ctx.fillText(line, 25, textY);
                    textY += lineHeight;
                });
            }
            
            const link = document.createElement('a');
            link.download = `barcode-${currentBarcodeData.number}.png`;
            link.href = exportCanvas.toDataURL('image/png');
            link.click();
        }

        function wrapText(ctx, text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = '';

            ctx.font = '14px Arial';

            for (let i = 0; i < words.length; i++) {
                const testLine = currentLine + words[i] + ' ';
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && i > 0) {
                    lines.push(currentLine.trim());
                    currentLine = words[i] + ' ';
                } else {
                    currentLine = testLine;
                }
            }
            lines.push(currentLine.trim());
            return lines;
        }

        function startCamera() {
            const reader = document.getElementById('reader');
            const instruction = document.getElementById('scanInstruction');
            reader.classList.remove('hidden');
            instruction.classList.add('hidden');
            document.getElementById('stopBtn').classList.remove('hidden');

            if (html5QrCode === null) {
                html5QrCode = new Html5Qrcode("reader");
            }

            html5QrCode.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 150 }
                },
                onScanSuccess,
                onScanError
            ).catch(err => {
                alert('Unable to start camera: ' + err);
                stopCamera();
            });
        }

        function stopCamera() {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    const reader = document.getElementById('reader');
                    const instruction = document.getElementById('scanInstruction');
                    reader.classList.add('hidden');
                    instruction.classList.remove('hidden');
                    document.getElementById('stopBtn').classList.add('hidden');
                }).catch(err => {
                    console.error('Error stopping camera:', err);
                });
            }
        }

        function scanFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (html5QrCode === null) {
                html5QrCode = new Html5Qrcode("reader");
            }

            html5QrCode.scanFile(file, true)
                .then(decodedText => {
                    onScanSuccess(decodedText);
                })
                .catch(err => {
                    alert('No barcode found in image. Please try another image.');
                    console.error('Scan error:', err);
                });

            event.target.value = '';
        }

        function onScanSuccess(decodedText) {
            console.log('Barcode detected:', decodedText);

            if (html5QrCode && html5QrCode.isScanning) {
                stopCamera();
            }

            displayProductInfo(decodedText);
        }

        function onScanError(error) {
            // Ignore continuous scan errors
        }

        function displayProductInfo(barcode) {
            const product = productDatabase[barcode];
            const displayDiv = document.getElementById('productDisplay');
            
            displayDiv.classList.remove('hidden');

            if (product) {
                const isInStock = product.stock === 'In Stock';
                
                displayDiv.innerHTML = `
                    <div class="product-card">
                        <div class="product-header">
                            <h2>${product.name}</h2>
                            <div class="product-status ${isInStock ? 'in-stock' : 'out-of-stock'}">
                                ${product.stock}
                            </div>
                        </div>
                        <div class="product-body">
                            <div class="product-image">
                                <span>Product Image</span>
                            </div>

                            ${product.message ? `
                            <div class="message-section">
                                <div class="message-section-title">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    Custom Message
                                </div>
                                <div class="message-section-text">${escapeHtml(product.message)}</div>
                            </div>
                            ` : ''}

                            <div class="product-detail-grid">
                                <div class="product-detail">
                                    <div class="product-detail-label">Price</div>
                                    <div class="product-detail-value product-price">$${product.price.toFixed(2)}</div>
                                </div>
                                <div class="product-detail">
                                    <div class="product-detail-label">Brand</div>
                                    <div class="product-detail-value">${product.brand}</div>
                                </div>
                                <div class="product-detail">
                                    <div class="product-detail-label">Category</div>
                                    <div class="product-detail-value">${product.category}</div>
                                </div>
                                <div class="product-detail">
                                    <div class="product-detail-label">SKU</div>
                                    <div class="product-detail-value">${product.sku}</div>
                                </div>
                                <div class="product-detail">
                                    <div class="product-detail-label">Weight</div>
                                    <div class="product-detail-value">${product.weight}</div>
                                </div>
                                <div class="product-detail">
                                    <div class="product-detail-label">Warranty</div>
                                    <div class="product-detail-value">${product.warranty}</div>
                                </div>
                            </div>

                            <div class="product-description">
                                <div class="product-description-title">Product Description</div>
                                <div class="product-description-text">${product.description}</div>
                            </div>

                            <div class="product-detail-grid">
                                <div class="product-detail">
                                    <div class="product-detail-label">Manufacturer</div>
                                    <div class="product-detail-value" style="font-size: 14px;">${product.manufacturer}</div>
                                </div>
                                <div class="product-detail">
                                    <div class="product-detail-label">Barcode</div>
                                    <div class="product-detail-value" style="font-size: 14px; font-family: monospace;">${product.barcode}</div>
                                </div>
                            </div>

                            <div class="barcode-display">
                                <canvas id="productBarcode"></canvas>
                            </div>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    const canvas = document.getElementById('productBarcode');
                    if (canvas) {
                        JsBarcode(canvas, product.barcode, {
                            format: "CODE128",
                            width: 2,
                            height: 80,
                            displayValue: true,
                            fontSize: 14,
                            margin: 10
                        });
                    }
                }, 100);

            } else {
                displayDiv.innerHTML = `
                    <div class="product-card">
                        <div class="product-header">
                            <h2>Product Not Found</h2>
                        </div>
                        <div class="product-body">
                            <div class="no-product">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="8" x2="12" y2="12"/>
                                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                                </svg>
                                <p style="font-size: 16px; margin-top: 15px;">No product information available for barcode:</p>
                                <p style="font-family: monospace; font-size: 18px; font-weight: 600; margin-top: 10px;">${barcode}</p>
                                <p style="font-size: 14px; color: #999; margin-top: 20px;">This barcode is not registered in the database. Generate and save it first!</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            displayDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        window.addEventListener('beforeunload', () => {
            if (html5QrCode) {
                html5QrCode.stop().catch(err => console.error(err));
            }
        });
    </script>
</body>
</html>
