<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Improved QR Code Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; }
    .box { background: #fff; border-radius: 12px; max-width: 400px; margin: 40px auto; padding: 32px 28px; box-shadow: 0 6px 32px #0002; }
    h2 { text-align: center; }
    .row { margin: 22px 0; }
    label { font-weight: 600; margin-bottom: 6px; display: block; }
    select, input, textarea { font-size: 1.1em; padding: 10px; border-radius: 7px; border: 1px solid #aaa; width: 100%; margin-bottom: 6px; }
    textarea { resize: vertical; height: 68px; }
    #qrcode { margin: 26px auto 12px auto; width: 256px; height: 256px; }
    button { background: #3b82f6; color: #fff; border: 0; font-size: 1.08em; padding: 12px 20px; border-radius: 6px; margin: 8px 0 0 0; cursor: pointer; margin-right: 12px; }
    button:disabled { background: #aaa; }
    .desc { font-size: 0.94em; color: #666; margin-bottom: 12px; }
    .error { color: #c00; font-size: 0.92em; margin-bottom: 10px; }
    .note { color: #36860c; font-size: 0.95em; margin-bottom: 8px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>QR Code Generator By Continent</h2>
    <div class="desc">Make QR for a <b>Website Link</b> (URL) or <b>Plain Text</b>. Output is always 100% readable when scanned via any QR code scanner. Downloads are high quality.</div>

    <div class="row">
      <label for="type">QR Type:</label>
      <select id="type"><option value="url">Website (URL)</option><option value="text">Plain Text</option></select>
    </div>

    <div class="row" id="url-input-row">
      <label for="url-input">Website URL</label>
      <input type="text" id="url-input" placeholder="https://your-domain.com">
    </div>
    <div class="row" id="text-input-row" style="display: none;">
      <label for="text-input">Text (Display only)</label>
      <textarea id="text-input" maxlength="300" placeholder="Any text will show in the scanner"></textarea>
      <div class="note"><span id="charcount">0</span>/300 characters</div>
    </div>
    <div id="error" class="error" style="display:none"></div>
    <button id="gen">Generate</button>
    <button id="download" disabled>Download</button>
    <div id="qrcode"></div>
  </div>

  <script>
let lastData = "";

function validateURL(url) {
  try {
    const u = new URL(url);
    return u.protocol === "http:" || u.protocol === "https:";
  } catch {
    return false;
  }
}

function showError(msg) {
  const e = document.getElementById("error");
  e.innerText = msg;
  e.style.display = msg ? "" : "none";
}

function clearError() { showError(""); }

function updateQRCode(data) {
  let qrcodeEl = document.getElementById("qrcode");
  qrcodeEl.innerHTML = "";
  // Default size 256x256
  window.qr = new QRCode(qrcodeEl, {
    text: data,
    width: 256,
    height: 256,
    colorDark : "#000000",
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.H // robust
  });
}

document.getElementById("type").addEventListener("change", function() {
  let ty = this.value;
  document.getElementById("url-input-row").style.display = ty === "url" ? "" : "none";
  document.getElementById("text-input-row").style.display = ty === "text" ? "" : "none";
  document.getElementById("qrcode").innerHTML = "";
  document.getElementById("download").disabled = true;
  clearError();
});

document.getElementById("text-input").addEventListener("input", function() {
  document.getElementById("charcount").innerText = this.value.length;
});

document.getElementById("gen").addEventListener("click", function() {
  clearError();
  let mode = document.getElementById("type").value;
  let data = "";
  if (mode === "url") {
    let url = (document.getElementById("url-input").value || "").trim();
    if (!url) { showError("Please enter a URL!"); return; }
    // Smart add https://
    if (!/^https?:\/\//i.test(url)) url = "https://" + url;
    if (!validateURL(url)) { showError("Please enter a valid URL."); return; }
    data = url;
  } else {
    let txt = (document.getElementById("text-input").value || "").trim();
    if (!txt) { showError("Please enter some text!"); return; }
    if (txt.length > 300) { showError("Text is too long."); return; }
    data = txt;
  }
  updateQRCode(data);
  lastData = data;
  document.getElementById("download").disabled = false;
});

document.getElementById("download").addEventListener("click", function() {
  // Use the canvas inside the #qrcode div
  let canvas = document.querySelector("#qrcode canvas");
  if (!canvas) { showError("Please generate a QR code first."); return; }
  let url = canvas.toDataURL("image/png");
  let link = document.createElement('a');
  let cleanTxt = (lastData || "qr").replace(/[^a-zA-Z0-9]/g, "_").slice(0,20);
  link.download = `QR_${cleanTxt}.png`;
  link.href = url;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
});
  </script>
</body>
</html>
