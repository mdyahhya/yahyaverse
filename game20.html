<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panda Login Form</title>
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css" />
    <style>
*{
  padding: 0;
  margin: 0;
  box-sizing: border-box;
  font-family: "Poppins", sans-serif;
}
body {
  background-color: #f4c531;
}
.container {
  height: 31.25em;
  width: 31.25em;
  position: absolute;
  transform: translate(-50%, -50%);
  top: 50%;
  left: 50%;
}
form {
  width: 23.75em;
  min-height: 22em;
  background-color: #ffffff;
  position: absolute;
  transform: translate(-50%, -50%);
  top: calc(50% + 3.1em);
  left: 50%;
  padding: 1.5em 3.1em;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-radius: 0.5em;
}
form label {
  display: block;
  margin-bottom: 0.2em;
  font-weight: 600;
  color: #2e0d30;
}
form input {
  font-size: 0.95em;
  font-weight: 400;
  color: #3f3554;
  padding: 0.3em;
  border: none;
  border-bottom: 0.12em solid #3f3554;
  outline: none;
}
form input:focus {
  border-color: #f4c531;
}
form input:not(:last-child) {
  margin-bottom: 0.9em;
}
form button {
  font-size: 0.95em;
  padding: 0.8em 0;
  border-radius: 2em;
  border: none;
  cursor: pointer;
  outline: none;
  background-color: #f4c531;
  color: #2e0d30;
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 0.15em;
  margin-top: 0.8em;
  transition: 0.5s ;
}
form h3 {
  margin-top: 2.2em; 

}
.message {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    border-radius: 8px;
    color: white;
    font-size: 14px;
    display: none;
    z-index: 1000;
}
.message.success {
    background-color: #10b981;
    box-shadow: 0 0 20px #10b98166;
}
.message.error {
    background-color: #ef4444;
    box-shadow: 0 0 20px #ef444466;
}
.panda-face {
  height: 7.5em;
  width: 8.4em;
  background-color: #ffffff;
  border: 0.18em solid #2e0d30;
  border-radius: 7.5em 7.5em 5.62em 5.62em;
  position: absolute;
  top: 2em;
  margin: auto;
  left: 0;
  right: 0;
}
.ear-l, .ear-r {
  background-color: #3f3554;
  height: 2.5em;
  width: 2.81em;
  border: 0.18em solid #2e0d30;
  border-radius: 2.5em 2.5em 0 0;
  top: 1.75em;
  position: absolute;
}
.ear-l {
  transform: rotate(-38deg);
  left: 10.75em;
}
.ear-r {
  transform: rotate(38deg);
  right: 10.75em;
}
.blush-l, .blush-r {
  background-color: #ff8bb1;
  height: 1em;
  width: 1.37em;
  border-radius: 50%;
  position: absolute;
  top: 4em;
}
.blush-l {
  transform: rotate(25deg);
  left: 1em;
}
.blush-r {
  transform: rotate(-25deg);
  right: 1em;
}
.eye-l, .eye-r {
  background-color: #3f3554;
  height: 2.18em;
  width: 2em;
  border-radius: 2em;
  position: absolute;
  top: 2.18em;
}
.eye-l {
  left: 1.37em;
  transform: rotate(-20deg);
}
.eye-r {
  right: 1.37em;
  transform: rotate(20deg);
}
.eyeball-l, .eyeball-r {
  height: 0.6em;
  width: 0.6em;
  background-color: #ffffff;
  border-radius: 50%;
  position: absolute;
  left: 0.6em;
  top: 0.6em;
  transition: 1s all;
}
.eyeball-l {
  transform: rotate(20deg);
}
.eyeball-r {
  transform: rotate(-20deg);
}
.nose {
  height: 1em;
  width: 1em;
  background-color: #3f3554;
  position: absolute;
  top: 4.37em;
  margin: auto;
  left: 0;
  right: 0;
  border-radius: 1.2em 0 0 0.25em;
  transform: rotate(45deg);
}
.nose:before {
  content: "";
  position: absolute;
  background-color: #3f3554;
  height: 0.6em;
  width: 0.1em;
  transform: rotate(-45deg);
  top: 0.75em;
  left: 1em;
}
.mouth, .mouth:before {
  height: 0.75em;
  width: 0.93em;
  background-color: transparent;
  position: absolute;
  border-radius: 50%;
  box-shadow: 0 0.18em #3f3554;
}
.mouth {
  top: 5.31em;
  left: 3.12em;
}
.mouth:before {
  content: "";
  position: absolute;
  left: 0.87em;
}
.hand-l, .hand-r {
  background-color: #3f3554;
  height: 2.81em;
  width: 2.5em;
  border: 0.18em solid #2e0d30;
  border-radius: 0.6em 0.6em 2.18em 2.18em;
  transition: 1s all;
  position: absolute;
  top: 8.4em;
}
.hand-l {
  left: 7.5em;
}
.hand-r {
  right: 7.5em;
}
.paw-l, .paw-r {
  background-color: #3f3554;
  height: 3.12em;
  width: 3.12em;
  border: 0.18em solid #2e0d30;
  border-radius: 2.5em 2.5em 1.2em 1.2em;
  position: absolute;
  top: 26.56em;
}
.paw-l {
  left: 10em;
}
.paw-r {
  right: 10em;
}
.paw-l:before, .paw-r:before {
  position: absolute;
  content: "";
  background-color: #ffffff;
  height: 1.37em;
  width: 1.75em;
  top: 1.12em;
  left: 0.55em;
  border-radius: 1.56em 1.56em 0.6em 0.6em;
}
.paw-l:after, .paw-r:after {
  position: absolute;
  content: "";
  background-color: #ffffff;
  height: 0.5em;
  width: 0.5em;
  border-radius: 50%;
  top: 0.31em;
  left: 1.12em;
  box-shadow: 0.87em 0.37em #ffffff, -0.87em 0.37em #ffffff;
}
@media screen and (max-width: 500px) {
  .container {
    font-size: 14px;
  }
}

    </style>
  </head>
  <body>
    <div id="message" class="message"></div>
    
    <div class="container">
      <!-- Registration Form -->
      <form id="register-form">
        <h3 style="text-align: center; color: #2e0d30; margin-bottom: 1em;">REGISTER</h3>
        <label for="reg-email">Email:</label>
        <input type="email" id="reg-email" placeholder="abc@xyz.com" required/>
        <label for="reg-password">Password:</label>
        <input type="password" id="reg-password" placeholder="Password (5+ chars)..." required/>
       
        <button type="button" id="register-btn">Register</button>
        <p style="text-align: center; margin-top: 0.8em; font-size: 0.85em; margin-top:2.5em; cursor: pointer;" onclick="switchToLogin()">
          Already have an account? <span style="color: black; text-decoration: underline;">Login</span>
        </p>
      </form>
      
      <!-- Login Form (hidden by default) -->
      <form id="login-form" style="display: none;">
        <h3 style="text-align: center; color: #2e0d30; margin-bottom: 1em;">LOGIN</h3>
        <label for="login-email">Email:</label>
        <input type="email" id="login-email" placeholder="abc@xyz.com" required/>
        <label for="login-password">Password:</label>
        <input type="password" id="login-password" placeholder="Password here..." required/>
        <button type="button" id="login-btn">Login</button>
        <p style="text-align: center; margin-top: 0.8em; font-size: 0.85em;margin-top:2.5em; cursor: pointer;" onclick="switchToRegister()">
          Don't have an account? <span style="color: black; text-decoration: underline;">Register</span>
        </p>
      </form>
      
      <!-- Welcome Screen (hidden by default) -->
      <div id="welcome-screen" style="display: none; background: #ffffff; padding: 3em 2em; border-radius: 0.5em; position: absolute; top: calc(50% + 3.1em); left: 50%; transform: translate(-50%, -50%); width: 23.75em; text-align: center;">
        <h2 style="color: #2e0d30; margin-bottom: 1em;">Welcome!</h2>
        <p id="welcome-user" style="color: #3f3554; font-size: 1.1em; margin-bottom: 2em;"></p>
        <button id="logout-btn" style="background-color: #ff4444; color: white; padding: 0.8em 2em; border: none; border-radius: 2em; cursor: pointer; font-weight: 600;">LOGOUT</button>
      </div>
      
      <div class="ear-l"></div>
      <div class="ear-r"></div>
      <div class="panda-face">
        <div class="blush-l"></div>
        <div class="blush-r"></div>
        <div class="eye-l">
          <div class="eyeball-l"></div>
        </div>
        <div class="eye-r">
          <div class="eyeball-r"></div>
        </div>
        <div class="nose"></div>
        <div class="mouth"></div>
      </div>
      <div class="hand-l"></div>
      <div class="hand-r"></div>
      <div class="paw-l"></div>
      <div class="paw-r"></div>
    </div>
    
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Script -->
  <script>

      
// Initialize Supabase
const sb = supabase.createClient('https://nsnacwwcrszpjmanskti.supabase.co', 
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zbmFjd3djcnN6cGptYW5za3RpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTg2MTIsImV4cCI6MjA2ODQ5NDYxMn0.W01JADzAuGFvcAHAN6LPRIxc75J7A9Q76HIxvxkJDn4');

// DOM Elements
const messageEl = document.getElementById('message');
const registerForm = document.getElementById('register-form');
const loginForm = document.getElementById('login-form');
const welcomeScreen = document.getElementById('welcome-screen');
const welcomeUser = document.getElementById('welcome-user');

// Registration Elements
const regEmailEl = document.getElementById('reg-email');
const regPasswordEl = document.getElementById('reg-password');
const registerBtn = document.getElementById('register-btn');

// Login Elements
const loginEmailEl = document.getElementById('login-email');
const loginPasswordEl = document.getElementById('login-password');
const loginBtn = document.getElementById('login-btn');

// Logout
const logoutBtn = document.getElementById('logout-btn');

// Panda Elements
let eyeL = document.querySelector(".eyeball-l");
let eyeR = document.querySelector(".eyeball-r");
let handL = document.querySelector(".hand-l");
let handR = document.querySelector(".hand-r");

// Message function
function showMessage(text, type) {
    messageEl.textContent = text;
    messageEl.className = `message ${type}`;
    messageEl.style.display = 'block';
    setTimeout(() => {
        messageEl.style.display = 'none';
    }, 4000);
}

// Switch forms
function switchToLogin() {
    registerForm.style.display = 'none';
    loginForm.style.display = 'flex';
    normalEyeStyle();
    normalHandStyle();
}

function switchToRegister() {
    loginForm.style.display = 'none';
    registerForm.style.display = 'flex';
    normalEyeStyle();
    normalHandStyle();
}

// Check if already logged in
function checkLoginStatus() {
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
        const userData = JSON.parse(loggedInUser);
        showWelcomeScreen(userData.email);
    }
}

function showWelcomeScreen(email) {
    registerForm.style.display = 'none';
    loginForm.style.display = 'none';
    welcomeScreen.style.display = 'block';
    welcomeUser.textContent = `Welcome, ${email}`;
    normalEyeStyle();
    normalHandStyle();
}

// Panda animation functions
let normalEyeStyle = () => {
  eyeL.style.cssText = `left:0.6em; top: 0.6em;`;
  eyeR.style.cssText = `right:0.6em; top:0.6em;`;
};

let normalHandStyle = () => {
  handL.style.cssText = `height: 2.81em; top:8.4em; left:7.5em; transform: rotate(0deg);`;
  handR.style.cssText = `height: 2.81em; top: 8.4em; right: 7.5em; transform: rotate(0deg)`;
};

let hideEyesWithHands = () => {
  handL.style.cssText = `height: 6.56em; top: 3.87em; left: 11.75em; transform: rotate(-155deg);`;
  handR.style.cssText = `height: 6.56em; top: 3.87em; right: 11.75em; transform: rotate(155deg);`;
  normalEyeStyle();
};

// Registration email focus
regEmailEl.addEventListener("focus", () => {
  eyeL.style.cssText = `left: 0.75em; top: 1.12em;`;
  eyeR.style.cssText = `right: 0.75em; top: 1.12em;`;
  normalHandStyle();
});

// Registration password focus
regPasswordEl.addEventListener("focus", () => {
  hideEyesWithHands();
});

// Login email focus
loginEmailEl.addEventListener("focus", () => {
  eyeL.style.cssText = `left: 0.75em; top: 1.12em;`;
  eyeR.style.cssText = `right: 0.75em; top: 1.12em;`;
  normalHandStyle();
});

// Login password focus
loginPasswordEl.addEventListener("focus", () => {
  hideEyesWithHands();
});

// Click outside
document.addEventListener("click", (e) => {
  let clickedElem = e.target;
  if (clickedElem != regEmailEl && clickedElem != regPasswordEl && 
      clickedElem != loginEmailEl && clickedElem != loginPasswordEl) {
    normalEyeStyle();
    normalHandStyle();
  }
});

registerBtn.addEventListener('click', async () => {
    const email = regEmailEl.value;
    const password = regPasswordEl.value;

    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    
    if (!emailRegex.test(email)) {
        showMessage('Please enter a valid email', 'error');
        return;
    }
    
    if (password.length <= 4) {
        showMessage('Password must be more than 4 characters', 'error');
        return;
    }

    const { data, error } = await sb
        .from('users')
        .insert([{ email: email, password: password, agreed: true }])
        .select();

    if (error) {
        if (error.message.includes('duplicate')) {
            showMessage('Email already registered. Please login.', 'error');
        } else {
            showMessage('Registration failed: ' + error.message, 'error');
        }
    } else {
        showMessage('Registration successful! Please login.', 'success');
        setTimeout(() => {
            switchToLogin();
        }, 2000);
    }
});

// LOGIN
loginBtn.addEventListener('click', async () => {
    const email = loginEmailEl.value;
    const password = loginPasswordEl.value;

    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

    
    if (!emailRegex.test(email)) {
        showMessage('Please enter a valid email', 'error');
        return;
    }
    
    if (password.length <= 4) {
        showMessage('Password must be more than 4 characters', 'error');
        return;
    }

    // Check credentials
    const { data, error } = await sb
        .from('users')
        .select('*')
        .eq('email', email)
        .eq('password', password)
        .single();

    if (error || !data) {
        showMessage('Invalid email or password', 'error');
    } else {
        showMessage('Login successful!', 'success');
        
        const loginData = {
            email: data.email,
            loginTime: new Date().toISOString()
        };
        localStorage.setItem('loggedInUser', JSON.stringify(loginData));
        
        setTimeout(() => {
            showWelcomeScreen(data.email);
        }, 1000);
    }
});

// LOGOUT
logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('loggedInUser');
    welcomeScreen.style.display = 'none';
    loginForm.style.display = 'flex';
    loginEmailEl.value = '';
    loginPasswordEl.value = '';
    showMessage('Logged out successfully', 'success');
});

// Check login on page load
checkLoginStatus();

// Make switch functions global
window.switchToLogin = switchToLogin;
window.switchToRegister = switchToRegister;

    </script>
  </body>
</html>
